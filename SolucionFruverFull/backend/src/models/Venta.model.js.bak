// backend/src/models/Venta.model.js
import mongoose from 'mongoose';

const ventaItemSchema = new mongoose.Schema(
  {
    producto: { type: mongoose.Schema.Types.ObjectId, ref: 'Producto', required: true },
    nombre: { type: String, required: true },           // snapshot
    unidad: { type: String, required: true },           // 'kg' | 'lb' | 'unit' | 'pack' ...
    precioBaseKg: { type: Number, default: 0 },         // si es de peso: COP/KG
    precioUnitario: { type: Number, required: true },   // COP por unidad efectiva (kg o pieza)
    cantidadIngresada: { type: Number, required: true },// lo que digitó el cajero (podría ser en lb)
    unidadIngresada: { type: String, required: true },  // 'kg' | 'lb' | 'unit' | 'pack'
    cantidadKg: { type: Number, default: 0 },           // normalizada a kg cuando aplica
    totalItem: { type: Number, required: true },
  },
  { _id: false }
);

const ventaSchema = new mongoose.Schema(
  {
    factura: { type: Number, index: true, required: true },   // número secuencial
    cajero: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
    items: { type: [ventaItemSchema], required: true },
    subtotal: { type: Number, required: true },
    total: { type: Number, required: true },
    efectivo: { type: Number, default: 0 },
    cambio: { type: Number, default: 0 },
  },
  { timestamps: true }
);

export default mongoose.model('Venta', ventaSchema);
